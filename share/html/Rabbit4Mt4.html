<!DOCTYPE html>
<html>
<!-- This file is automatically generated: do not edit. -->
<head>
<title>Rabbit4Mt4</title>
<meta charset="utf-8">
</head>
<body>
<!-- <h1>Rabbit4Mt4</h1> -->
<h2>Rabbit4Mt4</h2>

<p>There's a problem with the current approach of using <a href="OTMql4AMQP">Home</a> which is<br />
<a href="RoundTripping">https://github.com/OpenTrading/OTMql4AMQP/wiki/RoundTripping</a>:<br />
Mt4 can call Python in <a href="OTMql4AMQP">Home</a>, but Python can't call Mt4.</p>

<p>This costs us up to 10 seconds per call to Mt4, unless we speed up the<br />
timer events, which may add to the load on Mt4.</p>

<ul>
	<li>first we need to measure the load on Mt4 for decreasing the timer period.</li>
</ul>
<p>Another approach is to replace <a href="OTMql4AMQP">Home</a> in Mt4 with something like<br />
<a href="https://github.com/femtotrader/rabbit4mt4/">https://github.com/femtotrader/rabbit4mt4/</a><br />
Then OpenTrader would be speaking to Mt4 over RabbitMQ without the poll into Python.</p>

<p>It shouldn't be hard to wire up: <tt>ePyPikaPopQueue</tt> in <tt>OnTimer</tt> of<br />
<a href="OTPyTestPikaEA.mq4">https://github.com/OpenTrading/OTMql4AMQP/raw/master/MQL4/Experts/OTMql4/OTPyTestPikaEA.mq4</a><br />
pops the queue of things to do, which is just an Mt4 command as a string.</p>
<pre>
    uRetval = ePyPikaPopQueue(uCHART_ID);
</pre>
<p>It just pops the queue from Python, then calls <tt>uOTPyPikaProcessCmd</tt>,<br />
which is a portable library command that should work in any Mt4.</p>
<pre>
uOutput = uOTPyPikaProcessCmd(uInput);
</pre>
<p>It then just takes the result of the evaluation and puts it back on AMQP to OpenTrader:</p>
<pre>
uInfo = zOTLibSimpleFormatRetval("retval", uCHART_ID, 0, "", uOutput);
eReturnOnSpeaker(uCHART_ID, "retval", uInfo, uInput);
</pre>

<p>Similarly, there's not much to sending OpenTrader timer, bar and tick events<br />
from <tt>OnTick</tt>:</p>
<pre>
uMess  = zOTLibSimpleFormatTick(uType, uCHART_ID, 0, uTime, uInfo);
eSendOnSpeaker(uCHART_ID, uType, uMess);
</pre>

<p>If <a href="rabbit4mt4">https://github.com/femtotrader/rabbit4mt4</a> could be wired up to<br />
these calls, then maybe OpenTrader could talk to Mt4 with only the <tt>rabbit4mt4</tt><br />
DLLs and header file to install in the target Mt4, which would greatly simplify<br />
the distribution of OpenTrader, because Python would not be required in the target Mt4.</p></body>
</html>
